<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="QR Master - Gerador de QR Code Profissional e Seguro.">
    <title>QR Master - Gerador Premium</title>
    
    <!-- √çcone -->
     <link rel="icon" type="image/png" href="logo.png">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { primary: '#4F46E5', secondary: '#9333EA', dark: '#0f172a' },
                    fontFamily: { sans: ['Outfit', 'sans-serif'] }
                }
            }
        }
    </script>
    <!-- Fontes -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- QR Code Library -->
    <script type="text/javascript" src="https://unpkg.com/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>
    
    <style>
        body { font-family: 'Outfit', sans-serif; background-color: #0f172a; color: white; }
        
        /* Glassmorphism */
        .glass {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }
        
        /* Inputs Customizados */
        .custom-input {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(71, 85, 105, 0.5);
            transition: all 0.3s ease;
        }
        .custom-input:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
            background: rgba(15, 23, 42, 0.8);
        }

        /* Anima√ß√µes */
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-slide-up { animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #020617; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        .loader { border: 3px solid rgba(255,255,255,0.1); border-left-color: #4F46E5; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="min-h-screen flex flex-col relative overflow-x-hidden selection:bg-indigo-500 selection:text-white">

    <!-- Background Animado -->
    <div class="fixed inset-0 overflow-hidden -z-10 pointer-events-none">
        <div class="absolute top-[-10%] left-[-10%] w-[50vw] h-[50vw] bg-indigo-600/10 rounded-full blur-[120px]"></div>
        <div class="absolute bottom-[-10%] right-[-10%] w-[50vw] h-[50vw] bg-purple-600/10 rounded-full blur-[120px]"></div>
    </div>

    <!-- ==========================================
         VISUALIZADOR (Modo Leitura)
         ========================================== -->
    <div id="viewer-app" class="hidden min-h-screen w-full flex-col items-center justify-center p-6 z-50 bg-gray-950/95 backdrop-blur-md fixed inset-0">
        <div class="max-w-md w-full animate-slide-up bg-gray-900 border border-gray-800 p-8 rounded-3xl shadow-2xl relative">
            <button onclick="window.location.href = window.location.pathname" class="absolute top-4 right-4 text-gray-500 hover:text-white transition-colors">‚úï</button>
            <div class="text-center mb-6">
                <div class="w-14 h-14 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl mx-auto flex items-center justify-center mb-4 shadow-lg shadow-indigo-500/30">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                    </svg>
                </div>
                <h2 class="text-2xl font-bold text-white">Conte√∫do Seguro</h2>
            </div>
            <div id="viewer-content" class="w-full mb-6 flex justify-center text-center"></div>
            <a href="https://cinemaxbr18-crypto.github.io/QR-Master/" class="block w-full text-center py-3 bg-gray-800 hover:bg-gray-700 rounded-xl text-white font-medium transition-all border border-gray-700">Criar meu pr√≥prio QR Code</a>
        </div>
    </div>

    <!-- ==========================================
         APP PRINCIPAL (Gerador)
         ========================================== -->
    <div id="main-app" class="flex flex-col min-h-screen">
        
        <!-- Header -->
        <header class="w-full px-6 py-4 flex justify-between items-center border-b border-gray-800 bg-gray-900/60 backdrop-blur-md sticky top-0 z-40">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center shadow-indigo-500/20 shadow-lg">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"></path></svg>
                </div>
                <h1 class="text-xl font-bold tracking-tight text-white hidden sm:block">QR Master</h1>
            </div>
            
            <div class="flex items-center gap-4">
                <div id="userBadge" class="hidden flex items-center gap-2 cursor-pointer group" onclick="App.toggleModal('profileModal')">
                    <div class="text-right hidden sm:block">
                        <p id="badge-name" class="text-sm font-semibold text-white leading-tight">Usu√°rio</p>
                        <p class="text-[10px] text-indigo-400 font-medium uppercase tracking-wider">Premium</p>
                    </div>
                    <div class="w-9 h-9 bg-gray-700 rounded-full flex items-center justify-center border border-gray-600 group-hover:border-indigo-500 transition-colors">üë§</div>
                </div>
                <button id="authBtn" class="text-sm bg-gray-800 hover:bg-gray-700 border border-gray-700 text-white px-5 py-2 rounded-lg transition-all font-medium shadow-lg hover:shadow-xl">
                    Entrar
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-grow container mx-auto p-4 md:p-8 flex flex-col lg:flex-row gap-8 items-start justify-center max-w-7xl">
            
            <!-- Painel de Configura√ß√£o -->
            <div class="w-full lg:w-5/12 glass rounded-3xl p-6 md:p-8 shadow-2xl animate-slide-up relative overflow-hidden">
                <div class="absolute top-0 right-0 w-32 h-32 bg-indigo-500/10 rounded-full blur-3xl -z-10"></div>

                <h2 class="text-2xl font-bold mb-6 text-white flex items-center gap-2">Criar QR Code</h2>

                <!-- Tabs -->
                <div class="grid grid-cols-5 gap-2 mb-8 bg-gray-900/50 p-1.5 rounded-xl border border-gray-700/50">
                    <button onclick="App.setTab('url')" data-tab="url" class="tab-btn active-tab flex flex-col items-center justify-center py-3 rounded-lg text-xs font-medium transition-all hover:bg-white/5">
                        <span class="text-lg mb-1">üîó</span>Link
                    </button>
                    <button onclick="App.setTab('text')" data-tab="text" class="tab-btn flex flex-col items-center justify-center py-3 rounded-lg text-xs font-medium transition-all hover:bg-white/5 text-gray-400">
                        <span class="text-lg mb-1">üìù</span>Texto
                    </button>
                    <button onclick="App.setTab('wifi')" data-tab="wifi" class="tab-btn flex flex-col items-center justify-center py-3 rounded-lg text-xs font-medium transition-all hover:bg-white/5 text-gray-400">
                        <span class="text-lg mb-1">üì°</span>Wi-Fi
                    </button>
                    <!-- Premium Tabs -->
                    <button onclick="App.setTab('image')" data-tab="image" class="tab-btn flex flex-col items-center justify-center py-3 rounded-lg text-xs font-medium transition-all hover:bg-white/5 text-gray-400 relative overflow-hidden">
                        <span class="text-lg mb-1">üñºÔ∏è</span>Img
                        <div class="absolute top-0.5 right-0.5 w-1.5 h-1.5 bg-yellow-500 rounded-full"></div>
                    </button>
                    <button onclick="App.setTab('pix')" data-tab="pix" class="tab-btn flex flex-col items-center justify-center py-3 rounded-lg text-xs font-medium transition-all hover:bg-white/5 text-gray-400 relative overflow-hidden">
                        <span class="text-lg mb-1 text-green-400">‚ùñ</span>Pix
                        <div class="absolute top-0.5 right-0.5 w-1.5 h-1.5 bg-yellow-500 rounded-full"></div>
                    </button>
                </div>

                <!-- Inputs -->
                <div class="space-y-5 min-h-[200px]">
                    <!-- URL -->
                    <div id="inp-url" class="inp-group">
                        <label class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 block">URL de Destino</label>
                        <input type="url" id="val-url" placeholder="https://seu-site.com" class="custom-input w-full rounded-xl p-4 text-white outline-none">
                    </div>

                    <!-- Texto -->
                    <div id="inp-text" class="inp-group hidden">
                        <label class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 block">Mensagem</label>
                        <textarea id="val-text" rows="4" placeholder="Digite sua mensagem..." class="custom-input w-full rounded-xl p-4 text-white outline-none resize-none"></textarea>
                    </div>

                    <!-- Wi-Fi -->
                    <div id="inp-wifi" class="inp-group hidden space-y-4">
                        <div>
                            <label class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 block">Nome da Rede (SSID)</label>
                            <input type="text" id="val-wifi-ssid" class="custom-input w-full rounded-xl p-4 text-white outline-none">
                        </div>
                        <div class="flex gap-3">
                            <div class="flex-grow">
                                <label class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 block">Senha</label>
                                <input type="password" id="val-wifi-pass" class="custom-input w-full rounded-xl p-4 text-white outline-none">
                            </div>
                            <div class="w-1/3">
                                <label class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 block">Tipo</label>
                                <select id="val-wifi-type" class="custom-input w-full rounded-xl p-4 text-white outline-none h-[58px]">
                                    <option value="WPA">WPA</option>
                                    <option value="WEP">WEP</option>
                                    <option value="nopass">Livre</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Imagem (Premium) -->
                    <div id="inp-image" class="inp-group hidden relative">
                        <div class="premium-lock absolute inset-0 z-20 bg-gray-900/80 backdrop-blur-sm rounded-xl flex flex-col items-center justify-center border border-gray-700 hidden">
                            <span class="text-2xl mb-2">üîí</span>
                            <p class="font-bold text-white mb-2">Recurso Premium</p>
                            <button onclick="App.toggleModal('loginModal')" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg text-sm transition-colors">Desbloquear Gr√°tis</button>
                        </div>
                        <label class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 block">URL da Imagem</label>
                        <input type="url" id="val-image" placeholder="https://..." class="custom-input w-full rounded-xl p-4 text-white outline-none">
                        <p class="text-[10px] text-gray-500 mt-2">Recomendamos usar imgbb.com para hospedar sua imagem.</p>
                    </div>

                    <!-- Pix (Premium) -->
                    <div id="inp-pix" class="inp-group hidden relative space-y-4">
                         <div class="premium-lock absolute inset-0 z-20 bg-gray-900/80 backdrop-blur-sm rounded-xl flex flex-col items-center justify-center border border-gray-700 hidden">
                            <span class="text-2xl mb-2">üîí</span>
                            <p class="font-bold text-white mb-2">Gerador Pix Premium</p>
                            <button onclick="App.toggleModal('loginModal')" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg text-sm transition-colors">Desbloquear Gr√°tis</button>
                        </div>
                        <div>
                            <label class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 block">Chave Pix</label>
                            <input type="text" id="val-pix-key" placeholder="CPF, CNPJ, Email ou Celular" class="custom-input w-full rounded-xl p-4 text-white outline-none">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 block">Nome Benefici√°rio</label>
                                <input type="text" id="val-pix-name" class="custom-input w-full rounded-xl p-4 text-white outline-none">
                            </div>
                            <div>
                                <label class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 block">Cidade</label>
                                <input type="text" id="val-pix-city" class="custom-input w-full rounded-xl p-4 text-white outline-none">
                            </div>
                        </div>
                        <div>
                            <label class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 block">Valor (Opcional)</label>
                            <div class="relative">
                                <span class="absolute left-4 top-4 text-gray-400">R$</span>
                                <input type="number" step="0.01" id="val-pix-amount" placeholder="0.00" class="custom-input w-full rounded-xl p-4 pl-10 text-white outline-none">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Personaliza√ß√£o -->
                <div class="mt-8 pt-6 border-t border-gray-700/50">
                    <h3 class="text-sm font-bold text-gray-300 mb-4">Personaliza√ß√£o</h3>
                    <div class="flex gap-4 items-center">
                        <div class="relative group w-full">
                            <label class="block text-xs text-gray-500 mb-1">Logo Central</label>
                            <input type="file" id="logoInput" accept="image/*" class="block w-full text-xs text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-xs file:font-bold file:bg-gray-800 file:text-indigo-400 hover:file:bg-gray-700 cursor-pointer"/>
                            <div id="logoLock" class="absolute inset-0 bg-gray-900/90 rounded-lg flex items-center justify-center border border-gray-700 hidden">
                                <span class="text-[10px] font-bold text-gray-400 uppercase">Login Necess√°rio</span>
                            </div>
                        </div>
                        <div class="w-1/3">
                            <label class="block text-xs text-gray-500 mb-1">Cor</label>
                            <input type="color" id="colorInput" value="#4F46E5" class="w-full h-9 rounded cursor-pointer bg-transparent border-0">
                        </div>
                    </div>
                </div>

                <button onclick="App.generate()" class="w-full mt-8 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-indigo-500/20 transform transition-all active:scale-[0.98] border border-white/10 uppercase tracking-wide text-sm flex items-center justify-center gap-2">
                    <span id="gen-spinner" class="loader hidden"></span>
                    <span>Gerar QR Code</span>
                </button>
            </div>

            <!-- Painel de Preview -->
            <div class="w-full lg:w-5/12 flex flex-col items-center justify-center pt-8 lg:pt-0 sticky top-24">
                <div class="relative group">
                    <div class="absolute -inset-1 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-[2.5rem] blur-xl opacity-40 group-hover:opacity-60 transition duration-1000"></div>
                    <div class="relative bg-white p-6 rounded-[2rem] shadow-2xl">
                        <div id="qr-canvas" class="overflow-hidden rounded-xl bg-white"></div>
                    </div>
                </div>
                
                <div class="flex gap-3 mt-10 w-full max-w-xs">
                    <button onclick="App.download()" class="flex-1 flex items-center justify-center gap-2 bg-gray-800 hover:bg-gray-700 text-white py-3.5 rounded-xl font-bold transition-all border border-gray-700 shadow-lg">
                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>
                        Baixar
                    </button>
                    <button onclick="App.share()" class="w-14 flex items-center justify-center bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl transition-all shadow-lg">
                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" /></svg>
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- ==========================================
         MODALS
         ========================================== -->
    
    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black/80 z-[100] hidden items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-gray-800 rounded-3xl p-8 max-w-md w-full border border-gray-700 shadow-2xl relative animate-slide-up">
            <button onclick="App.toggleModal('loginModal')" class="absolute top-5 right-5 text-gray-500 hover:text-white">‚úï</button>
            <h2 class="text-2xl font-bold text-center mb-1">Acesse sua Conta</h2>
            <p class="text-gray-400 text-center text-sm mb-6">Desbloqueie recursos premium gratuitamente.</p>

            <button onclick="Auth.googleLogin()" class="w-full bg-white hover:bg-gray-100 text-gray-900 font-bold py-3 px-4 rounded-xl flex items-center justify-center gap-3 transition-colors mb-6">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" class="w-5 h-5"> Continuar com Google
            </button>

            <div class="relative flex py-2 items-center mb-6">
                <div class="flex-grow border-t border-gray-700"></div><span class="flex-shrink-0 mx-4 text-gray-500 text-xs font-bold uppercase">Ou Email</span><div class="flex-grow border-t border-gray-700"></div>
            </div>

            <div class="space-y-3">
                <input type="email" id="auth-email" placeholder="seu@email.com" class="custom-input w-full rounded-xl p-3 text-white">
                <input type="password" id="auth-pass" placeholder="Senha" class="custom-input w-full rounded-xl p-3 text-white">
            </div>

            <div class="flex gap-3 mt-6">
                <button onclick="Auth.emailLogin(false)" class="flex-1 bg-indigo-600 hover:bg-indigo-700 py-3 rounded-xl font-bold">Entrar</button>
                <button onclick="Auth.emailLogin(true)" class="flex-1 border border-indigo-500/50 text-indigo-400 hover:bg-indigo-900/20 py-3 rounded-xl font-bold">Criar Conta</button>
            </div>
            
            <p onclick="App.switchToReset()" class="text-center mt-4 text-xs text-gray-500 cursor-pointer hover:text-white underline">Esqueci minha senha</p>
        </div>
    </div>

    <!-- Reset Password Modal -->
    <div id="resetModal" class="fixed inset-0 bg-black/80 z-[110] hidden items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-gray-800 rounded-3xl p-8 max-w-sm w-full border border-gray-700 shadow-2xl relative animate-slide-up">
            <button onclick="App.toggleModal('resetModal')" class="absolute top-5 right-5 text-gray-500 hover:text-white">‚úï</button>
            <h3 class="text-xl font-bold mb-2">Recuperar Senha</h3>
            <p class="text-sm text-gray-400 mb-4">Enviaremos um link seguro para o seu email.</p>
            <input type="email" id="reset-email" placeholder="Digite seu email" class="custom-input w-full rounded-xl p-3 mb-4 text-white">
            <button onclick="Auth.sendReset()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-3 rounded-xl font-bold">Enviar Link</button>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profileModal" class="fixed inset-0 bg-black/80 z-[100] hidden items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-gray-800 rounded-3xl p-6 max-w-md w-full border border-gray-700 shadow-2xl relative animate-slide-up">
            <button onclick="App.toggleModal('profileModal')" class="absolute top-5 right-5 text-gray-500 hover:text-white">‚úï</button>
            <div class="flex items-center gap-4 mb-6">
                <div class="w-16 h-16 bg-indigo-600 rounded-full flex items-center justify-center text-3xl shadow-lg shadow-indigo-500/30">üë§</div>
                <div>
                    <h3 id="prof-name" class="text-xl font-bold">Usu√°rio</h3>
                    <p id="prof-email" class="text-sm text-gray-400">...</p>
                </div>
            </div>
            <div class="bg-gray-700/30 p-4 rounded-xl border border-gray-700/50 mb-6">
                <p class="text-sm text-indigo-300 font-bold flex items-center gap-2">‚ú® Status Premium Ativo</p>
                <p class="text-xs text-gray-500 mt-1">Voc√™ tem acesso ilimitado a todos os geradores.</p>
            </div>
            <button onclick="Auth.logout()" class="w-full border border-red-500/30 text-red-400 hover:bg-red-900/10 py-3 rounded-xl font-semibold transition-colors">Sair da Conta</button>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed bottom-5 right-5 px-6 py-4 rounded-xl bg-gray-800 text-white translate-y-32 transition-transform duration-300 z-[200] border border-gray-700 shadow-2xl font-medium flex items-center gap-3">
        <span id="toast-msg">Notifica√ß√£o</span>
    </div>

    <!-- L√≥gica (Atualizada para GitHub/Firebase e Dispositivos) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, signInWithPopup, GoogleAuthProvider, signInWithEmailAndPassword, 
            createUserWithEmailAndPassword, signOut, onAuthStateChanged, signInWithCustomToken, 
            signInAnonymously, sendPasswordResetEmail, updateProfile
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // ================= CONFIGURA√á√ÉO =================
        const firebaseConfig = {
            apiKey: "AIzaSyCGvo2a43dsDGBv0K6ELy0yjrPZmbemqVg",
            authDomain: "qr-master-65489.firebaseapp.com",
            projectId: "qr-master-65489",
            storageBucket: "qr-master-65489.firebasestorage.app",
            messagingSenderId: "303212642438",
            appId: "1:303212642438:web:65ef833e4ecacd00b21107",
            measurementId: "G-YB097SJZY1"
        };
        
        // ================= SISTEMA =================
        let app, auth, db, qr, currentUser;
        let currentTab = 'url';

        window.App = {
            init: async () => {
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                auth.languageCode = 'pt';
                db = getFirestore(app);

                // Viewer Mode Check (Funciona em subpastas do GitHub)
                const params = new URLSearchParams(window.location.search);
                if (params.has('msg') || params.has('img')) {
                    App.showViewer(params);
                    return;
                }

                // Auth Listener
                onAuthStateChanged(auth, (user) => {
                    currentUser = user;
                    App.updateUI(user);
                });

                // Init Login Pattern
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    try { 
                        await signInWithCustomToken(auth, __initial_auth_token); 
                    } catch(e) { 
                        console.warn("Token customizado inv√°lido, tentando login an√¥nimo...", e);
                        // Se falhar o token customizado, tenta an√¥nimo
                        if (!auth.currentUser) {
                            try { await signInAnonymously(auth); } catch(err) { console.log("Login an√¥nimo tamb√©m falhou", err); }
                        }
                    }
                } else if (!auth.currentUser) {
                    try { await signInAnonymously(auth); } catch(e){ console.log("Login an√¥nimo restrito"); }
                }

                // QR Init
                qr = new QRCodeStyling({
                    width: 1000, height: 1000, type: "svg",
                    data: "https://qr-master.com",
                    image: "",
                    dotsOptions: { color: "#4F46E5", type: "rounded" },
                    backgroundOptions: { color: "#ffffff" },
                    imageOptions: { crossOrigin: "anonymous", margin: 20 }
                });
                document.getElementById('qr-canvas').innerHTML = '';
                qr.append(document.getElementById('qr-canvas'));
                
                // Gera inicial para evitar vazio
                setTimeout(() => App.generate(true), 500);
            },

            updateUI: (user) => {
                const isGuest = !user || user.isAnonymous;
                const authBtn = document.getElementById('authBtn');
                const userBadge = document.getElementById('userBadge');
                
                if (isGuest) {
                    authBtn.innerText = "Entrar";
                    authBtn.onclick = () => App.toggleModal('loginModal');
                    userBadge.classList.add('hidden');
                    // Locks
                    document.querySelectorAll('.premium-lock').forEach(el => el.classList.remove('hidden'));
                    document.getElementById('logoLock').classList.remove('hidden');
                    document.getElementById('logoInput').disabled = true;
                } else {
                    authBtn.innerText = "Sair";
                    authBtn.onclick = Auth.logout;
                    userBadge.classList.remove('hidden');
                    // Tenta mostrar nome ou parte do email
                    let displayName = "Usu√°rio";
                    if(user.displayName) displayName = user.displayName;
                    else if(user.email) displayName = user.email.split('@')[0];
                    
                    document.getElementById('badge-name').innerText = displayName.substring(0, 15);
                    // Unlocks
                    document.querySelectorAll('.premium-lock').forEach(el => el.classList.add('hidden'));
                    document.getElementById('logoLock').classList.add('hidden');
                    document.getElementById('logoInput').disabled = false;
                    
                    // Profile Info
                    document.getElementById('prof-name').innerText = displayName;
                    document.getElementById('prof-email').innerText = user.email || "An√¥nimo";
                }
            },

            setTab: (tab) => {
                currentTab = tab;
                document.querySelectorAll('.tab-btn').forEach(b => {
                    b.classList.remove('active-tab', 'bg-indigo-600', 'text-white');
                    b.classList.add('text-gray-400');
                    if(b.dataset.tab === tab) {
                        b.classList.add('active-tab', 'bg-indigo-600', 'text-white');
                        b.classList.remove('text-gray-400');
                    }
                });
                document.querySelectorAll('.inp-group').forEach(el => el.classList.add('hidden'));
                document.getElementById(`inp-${tab}`).classList.remove('hidden');
            },

            generate: async (isInit = false) => {
                const isGuest = !currentUser || currentUser.isAnonymous;
                if (!isInit && isGuest && ['pix', 'image'].includes(currentTab)) return App.toggleModal('loginModal');

                const loader = document.getElementById('gen-spinner');
                if(loader) loader.classList.remove('hidden');

                try {
                    let data = "";
                    const color = document.getElementById('colorInput').value;
                    // L√≥gica robusta para URL no GitHub: remove query strings existentes
                    const baseUrl = window.location.href.split('?')[0];

                    // Data Logic
                    if (currentTab === 'url') {
                        data = document.getElementById('val-url').value || "https://google.com";
                        if(!data.startsWith('http')) data = "https://" + data;
                    } else if (currentTab === 'text') {
                        const txt = document.getElementById('val-text').value || "Ol√°!";
                        data = `${baseUrl}?msg=${encodeURIComponent(txt)}`;
                    } else if (currentTab === 'wifi') {
                        const ssid = document.getElementById('val-wifi-ssid').value;
                        const pass = document.getElementById('val-wifi-pass').value;
                        const type = document.getElementById('val-wifi-type').value;
                        if(ssid) data = `WIFI:T:${type};S:${ssid};P:${pass};;`;
                    } else if (currentTab === 'pix') {
                        const key = document.getElementById('val-pix-key').value;
                        const name = document.getElementById('val-pix-name').value;
                        const city = document.getElementById('val-pix-city').value;
                        if(key) data = App.generatePix(key, name, city, document.getElementById('val-pix-amount').value);
                    } else if (currentTab === 'image') {
                        const img = document.getElementById('val-image').value;
                        if(img) data = `${baseUrl}?img=${encodeURIComponent(img)}`;
                    }

                    if (!data && !isInit) throw new Error("Preencha os campos!");
                    if (!data) data = "https://qr-master.com"; // Fallback para init

                    // Style Update
                    const logoFile = document.getElementById('logoInput').files[0];
                    const updateOptions = {
                        data: data,
                        dotsOptions: { color: color },
                        image: ""
                    };

                    if (logoFile && !isGuest) {
                        const reader = new FileReader();
                        reader.onload = () => {
                            updateOptions.image = reader.result;
                            qr.update(updateOptions);
                        };
                        reader.readAsDataURL(logoFile);
                    } else {
                        qr.update(updateOptions);
                    }
                    
                    if(!isInit) App.toast("QR Code Atualizado!", "success");

                } catch (e) {
                    App.toast(e.message, "error");
                } finally {
                    if(loader) loader.classList.add('hidden');
                }
            },

            generatePix: (key, name, city, amount) => {
                name = (name || "NOME").substring(0, 25).toUpperCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                city = (city || "CIDADE").substring(0, 15).toUpperCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                const format = (id, val) => `${id}${val.length.toString().padStart(2, '0')}${val}`;
                let p = format('00', '01') + format('26', format('00', 'BR.GOV.BCB.PIX') + format('01', key)) + format('52', '0000') + format('53', '986');
                if (amount && parseFloat(amount) > 0) p += format('54', parseFloat(amount).toFixed(2));
                p += format('58', 'BR') + format('59', name) + format('60', city) + format('62', format('05', '***')) + '6304';
                
                const poly = 0x1021;
                let crc = 0xFFFF;
                for (let i = 0; i < p.length; i++) {
                    crc ^= p.charCodeAt(i) << 8;
                    for (let j = 0; j < 8; j++) {
                        if ((crc & 0x8000) !== 0) crc = (crc << 1) ^ poly;
                        else crc = crc << 1;
                    }
                }
                return p + (crc & 0xFFFF).toString(16).toUpperCase().padStart(4, '0');
            },

            download: () => qr.download({ name: "meu-qr-code", extension: "png" }),
            
            share: async () => {
                try {
                    const blob = await qr.getRawData("png");
                    const file = new File([blob], "qrcode.png", { type: "image/png" });
                    await navigator.share({ files: [file], title: "Meu QR Code" });
                } catch (e) { App.toast("Compartilhamento n√£o suportado.", "info"); }
            },

            showViewer: (params) => {
                document.getElementById('main-app').classList.add('hidden');
                document.getElementById('viewer-app').classList.remove('hidden');
                document.getElementById('viewer-app').classList.add('flex');
                
                const content = document.getElementById('viewer-content');
                if (params.has('img')) {
                    content.innerHTML = `<img src="${decodeURIComponent(params.get('img'))}" class="max-h-[60vh] rounded-xl shadow-2xl border border-gray-700">`;
                } else {
                    const msg = decodeURIComponent(params.get('msg'));
                    content.innerHTML = `<div class="bg-indigo-600 p-8 rounded-2xl shadow-xl"><p class="text-xl font-medium break-words">"${msg}"</p></div>`;
                }
            },

            toggleModal: (id) => {
                const el = document.getElementById(id);
                el.classList.toggle('hidden');
                el.classList.toggle('flex');
            },
            
            switchToReset: () => {
                App.toggleModal('loginModal');
                App.toggleModal('resetModal');
            },

            toast: (msg, type) => {
                const t = document.getElementById('toast');
                document.getElementById('toast-msg').innerText = msg;
                t.className = `fixed bottom-5 right-5 px-6 py-4 rounded-xl text-white transition-transform duration-300 z-[200] border border-gray-700 shadow-2xl font-medium flex items-center gap-3 ${type === 'error' ? 'bg-red-900/90' : (type === 'success' ? 'bg-green-900/90' : 'bg-gray-800')}`;
                t.classList.remove('translate-y-32');
                setTimeout(() => t.classList.add('translate-y-32'), 3000);
            }
        };

        window.Auth = {
            googleLogin: async () => {
                try {
                    await signInWithPopup(auth, new GoogleAuthProvider());
                    App.toggleModal('loginModal');
                    App.toast("Login realizado com sucesso!", "success");
                } catch (e) { App.toast("Erro no login Google", "error"); console.error(e); }
            },
            emailLogin: async (isNew) => {
                const email = document.getElementById('auth-email').value;
                const pass = document.getElementById('auth-pass').value;
                if(!email || !pass) return App.toast("Preencha email e senha", "error");
                try {
                    if (isNew) {
                        const res = await createUserWithEmailAndPassword(auth, email, pass);
                        await updateProfile(res.user, { displayName: email.split('@')[0] });
                        App.toast("Conta criada!", "success");
                    } else {
                        await signInWithEmailAndPassword(auth, email, pass);
                        App.toast("Bem-vindo de volta!", "success");
                    }
                    App.toggleModal('loginModal');
                } catch (e) { 
                    let msg = "Erro na autentica√ß√£o.";
                    if(e.code === 'auth/email-already-in-use') msg = "Email j√° usado.";
                    if(e.code === 'auth/weak-password') msg = "Senha fraca.";
                    App.toast(msg, "error"); 
                }
            },
            logout: () => signOut(auth).then(() => window.location.reload()),
            sendReset: async () => {
                const email = document.getElementById('reset-email').value;
                if(!email) return App.toast("Digite o email", "error");
                try {
                    // Redireciona para a mesma p√°gina ap√≥s reset
                    const actionCodeSettings = { url: window.location.href, handleCodeInApp: true };
                    await sendPasswordResetEmail(auth, email, actionCodeSettings);
                    App.toast("Email enviado! Verifique sua caixa de entrada.", "success");
                    App.toggleModal('resetModal');
                } catch(e) { App.toast("Erro ao enviar email.", "error"); }
            }
        };

        App.init();
    </script>
</body>
</html>
