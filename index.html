<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Master - Gerador Profissional de QR CODE</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <!-- QR Code Styling Lib -->
    <script type="text/javascript" src="https://unpkg.com/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>
    
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-analytics.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged, signInWithCustomToken, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, updateDoc, increment, collection } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Firebase Configuration (QR Master) ---
        const firebaseConfig = {
            apiKey: "AIzaSyCGvo2a43dsDGBv0K6ELy0yjrPZmbemqVg",
            authDomain: "qr-master-65489.firebaseapp.com",
            projectId: "qr-master-65489",
            storageBucket: "qr-master-65489.firebasestorage.app",
            messagingSenderId: "303212642438",
            appId: "1:303212642438:web:65ef833e4ecacd00b21107",
            measurementId: "G-YB097SJZY1"
        };

        // Initialize Firebase
        let auth, db, googleProvider, analytics;
        const appId = 'qr-master-app'; // ID interno do app para estrutura de dados

        try {
            const app = initializeApp(firebaseConfig);
            analytics = getAnalytics(app); // Inicializa Analytics
            auth = getAuth(app);
            auth.languageCode = 'pt';
            db = getFirestore(app);
            
            // Setup Google Provider
            googleProvider = new GoogleAuthProvider();
            googleProvider.addScope('profile');
            googleProvider.addScope('email');
        } catch (e) {
            console.error("Firebase init error:", e);
        }

        // --- State Management ---
        let currentUser = null;
        let qrCodeObj = null;
        let guestCount = parseInt(localStorage.getItem('guest_qr_count') || '0');
        const MAX_GUEST_LIMIT = 2;

        // --- DOM Elements ---
        const loginModal = document.getElementById('loginModal');
        const authBtn = document.getElementById('authBtn');
        const userBadge = document.getElementById('userBadge');
        const typeTabs = document.querySelectorAll('.type-tab');
        const inputSections = document.querySelectorAll('.input-section');
        const logoInput = document.getElementById('logoInput');
        const lockOverlay = document.getElementById('lockOverlay');

        // --- Auth Logic ---
        
        // Helper to attempt anonymous login safely
        const trySignInAnonymously = async () => {
            try {
                await signInAnonymously(auth);
            } catch (error) {
                // Ignore "admin-restricted-operation" which means Anon Auth is disabled in console
                if (error.code === 'auth/admin-restricted-operation') {
                    console.warn("Aviso: Login an√¥nimo desabilitado no Firebase Console. O app continuar√° em modo visitante offline.");
                } else {
                    console.error("Erro no login an√¥nimo:", error);
                }
            }
        };

        // Initial Auth Flow
        const initAuth = async () => {
            if (!auth) return;
            try {
                // Tenta usar token do ambiente se compat√≠vel, sen√£o fallback
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    try {
                        await signInWithCustomToken(auth, __initial_auth_token);
                    } catch (tokenError) {
                        console.warn("Token do ambiente n√£o corresponde a este projeto. Tentando fallback...");
                        if (!auth.currentUser) await trySignInAnonymously();
                    }
                } else {
                    if (!auth.currentUser) {
                        await trySignInAnonymously();
                    }
                }
            } catch (error) {
                console.error("Auth init error:", error);
            }
        };

        initAuth();

        window.toggleLoginModal = () => {
            if (currentUser && !currentUser.isAnonymous) {
                signOut(auth).then(() => {
                    showToast('Desconectado com sucesso!', 'success');
                    window.location.reload();
                });
            } else {
                loginModal.classList.remove('hidden');
                loginModal.classList.add('flex');
            }
        };

        window.closeModal = () => {
            loginModal.classList.add('hidden');
            loginModal.classList.remove('flex');
        };

        // GOOGLE LOGIN FUNCTION
        window.loginWithGoogle = async () => {
            if (!auth) {
                showToast("Erro: Firebase n√£o configurado.", "error");
                return;
            }
            try {
                const result = await signInWithPopup(auth, googleProvider);
                window.closeModal();
                showToast(`Bem-vindo, ${result.user.displayName}!`, "success");
            } catch (error) {
                console.error(error);
                let msg = "Erro no login.";
                if (error.code === 'auth/popup-closed-by-user') msg = "Login cancelado.";
                if (error.code === 'auth/popup-blocked') msg = "Popup bloqueado pelo navegador.";
                if (error.code === 'auth/operation-not-allowed') msg = "Login Google n√£o habilitado no console Firebase.";
                if (error.code === 'auth/unauthorized-domain') msg = "Dom√≠nio n√£o autorizado no Firebase.";
                showToast(msg, "error");
            }
        };

        window.handleEmailAuth = async (isRegister) => {
            const email = document.getElementById('emailInput').value;
            const pass = document.getElementById('passInput').value;
            
            if (!email || !pass) return showToast("Preencha todos os campos", "error");

            try {
                if (isRegister) {
                    await createUserWithEmailAndPassword(auth, email, pass);
                    showToast("Conta criada com sucesso!", "success");
                } else {
                    await signInWithEmailAndPassword(auth, email, pass);
                    showToast("Login realizado!", "success");
                }
                window.closeModal();
            } catch (error) {
                let msg = error.message;
                if(error.code === 'auth/email-already-in-use') msg = "Email j√° cadastrado.";
                if(error.code === 'auth/wrong-password') msg = "Senha incorreta.";
                if(error.code === 'auth/user-not-found') msg = "Usu√°rio n√£o encontrado.";
                showToast(msg, "error");
            }
        };

        // --- QR Code Logic ---

        function initQR() {
            qrCodeObj = new QRCodeStyling({
                width: 300,
                height: 300,
                type: "svg",
                data: "https://qr-master.app",
                image: "",
                dotsOptions: { color: "#4F46E5", type: "rounded" },
                backgroundOptions: { color: "#ffffff" },
                imageOptions: { crossOrigin: "anonymous", margin: 10 }
            });
            document.getElementById('canvas-container').innerHTML = '';
            qrCodeObj.append(document.getElementById('canvas-container'));
        }

        // PIX Payload Generator (CRC16)
        function generatePixPayload(key, name, city, amount, txid = '***') {
            name = name.substring(0, 25).toUpperCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
            city = city.substring(0, 15).toUpperCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
            key = key.trim();
            if(!txid) txid = '***';

            const formatField = (id, value) => {
                const len = value.length.toString().padStart(2, '0');
                return `${id}${len}${value}`;
            };

            let payload = 
                formatField('00', '01') + // Format Indicator
                formatField('26', 
                    formatField('00', 'BR.GOV.BCB.PIX') + 
                    formatField('01', key)
                ) +
                formatField('52', '0000') + // Merchant Category Code
                formatField('53', '986');   // Currency (BRL)

            if (amount) {
                payload += formatField('54', parseFloat(amount).toFixed(2));
            }

            payload += formatField('58', 'BR') +
                       formatField('59', name) +
                       formatField('60', city) +
                       formatField('62', formatField('05', txid));

            payload += '6304'; // Add CRC ID and length

            // Calculate CRC16
            const polynomial = 0x1021;
            let crc = 0xFFFF;

            for (let i = 0; i < payload.length; i++) {
                crc ^= payload.charCodeAt(i) << 8;
                for (let j = 0; j < 8; j++) {
                    if ((crc & 0x8000) !== 0) {
                        crc = (crc << 1) ^ polynomial;
                    } else {
                        crc = crc << 1;
                    }
                }
            }
            
            const crcHex = (crc & 0xFFFF).toString(16).toUpperCase().padStart(4, '0');
            return payload + crcHex;
        }

        // --- Main Logic ---

        window.switchTab = (type) => {
            typeTabs.forEach(t => {
                t.classList.remove('bg-indigo-600', 'text-white');
                t.classList.add('bg-gray-700', 'text-gray-300');
            });
            const activeTab = document.querySelector(`[onclick="switchTab('${type}')"]`);
            if(activeTab) {
                activeTab.classList.remove('bg-gray-700', 'text-gray-300');
                activeTab.classList.add('bg-indigo-600', 'text-white');
            }

            inputSections.forEach(s => s.classList.add('hidden'));
            const targetSection = document.getElementById(`input-${type}`);
            if(targetSection) targetSection.classList.remove('hidden');
            
            window.currentType = type;
        };

        function isGuest() {
            return !currentUser || currentUser.isAnonymous;
        }

        window.generateQR = async () => {
            // Check Limits
            if (isGuest()) {
                if (guestCount >= MAX_GUEST_LIMIT) {
                    window.toggleLoginModal();
                    showToast("Limite gratuito atingido! Fa√ßa login para criar mais.", "error");
                    return;
                }
                
                // Check if user tried to add logo without login
                const logoFile = logoInput.files[0];
                if (logoFile) {
                    window.toggleLoginModal();
                    showToast("Login necess√°rio para adicionar imagens/logos.", "error");
                    return;
                }
            }

            let data = "";
            
            try {
                if (window.currentType === 'url') {
                    const url = document.getElementById('url-val').value;
                    if(!url) throw new Error("Digite uma URL v√°lida");
                    data = url;
                } else if (window.currentType === 'text') {
                    const text = document.getElementById('text-val').value;
                    if(!text) throw new Error("Digite um texto");
                    data = text;
                } else if (window.currentType === 'wifi') {
                    const ssid = document.getElementById('wifi-ssid').value;
                    const pass = document.getElementById('wifi-pass').value;
                    const encryption = document.getElementById('wifi-type').value;
                    if(!ssid) throw new Error("Nome da rede √© obrigat√≥rio");
                    data = `WIFI:T:${encryption};S:${ssid};P:${pass};;`;
                } else if (window.currentType === 'pix') {
                    const key = document.getElementById('pix-key').value;
                    const name = document.getElementById('pix-name').value;
                    const city = document.getElementById('pix-city').value;
                    const amount = document.getElementById('pix-amount').value;
                    
                    if(!key || !name || !city) throw new Error("Chave, Nome e Cidade s√£o obrigat√≥rios para o Pix");
                    
                    data = generatePixPayload(key, name, city, amount);
                } else if (window.currentType === '2fa') {
                    const secret = document.getElementById('2fa-secret').value;
                    const account = document.getElementById('2fa-account').value || 'Usuario';
                    const issuer = document.getElementById('2fa-issuer').value || 'QR Master';
                    
                    if(!secret) throw new Error("O Segredo (Key) √© obrigat√≥rio");
                    
                    // Cleanup secret
                    const cleanSecret = secret.replace(/\s/g, '');
                    
                    data = `otpauth://totp/${encodeURIComponent(issuer)}:${encodeURIComponent(account)}?secret=${cleanSecret}&issuer=${encodeURIComponent(issuer)}&algorithm=SHA1&digits=6&period=30`;
                }

                // Handle Image
                const logoFile = logoInput.files[0];
                if (logoFile && !isGuest()) {
                    const reader = new FileReader();
                    reader.onload = () => {
                        qrCodeObj.update({ data: data, image: reader.result });
                        finishGeneration();
                    };
                    reader.readAsDataURL(logoFile);
                } else {
                    qrCodeObj.update({ data: data, image: "" });
                    finishGeneration();
                }

            } catch (e) {
                showToast(e.message, "error");
            }
        };

        async function finishGeneration() {
            if (isGuest()) {
                guestCount++;
                localStorage.setItem('guest_qr_count', guestCount);
                updateCounterUI();
            } else {
                // Save usage stats to Firestore
                try {
                   if(currentUser && currentUser.uid) {
                        // Use rules compliant path
                        const userStatsRef = doc(db, 'artifacts', appId, 'users', currentUser.uid, 'stats', 'usage');
                        await setDoc(userStatsRef, { count: increment(1), last_generated: new Date() }, { merge: true });
                   }
                } catch(e) { console.log("Stats update skipped/error", e); }
            }
            showToast("QR Code gerado com sucesso!", "success");
        }

        window.downloadQR = () => {
            qrCodeObj.download({ name: "qr-code-master", extension: "png" });
        };

        window.openImgBB = () => {
            window.open('https://pt-br.imgbb.com/', '_blank');
        };

        // --- Helpers ---

        function updateCounterUI() {
            const counterEl = document.getElementById('limitCounter');
            
            if (isGuest()) {
                counterEl.innerText = `Gerados: ${guestCount}/${MAX_GUEST_LIMIT} (Visitante)`;
                counterEl.classList.remove('hidden', 'text-green-400');
                counterEl.classList.add('text-gray-500');
                
                lockOverlay.classList.remove('hidden');
                logoInput.disabled = true;
            } else {
                counterEl.innerText = "Modo Ilimitado (Premium)";
                counterEl.classList.remove('hidden', 'text-gray-500');
                counterEl.classList.add('text-green-400');
                
                lockOverlay.classList.add('hidden');
                logoInput.disabled = false;
            }
        }

        function showToast(msg, type) {
            const toast = document.getElementById('toast');
            toast.innerText = msg;
            toast.className = `fixed bottom-5 right-5 px-6 py-3 rounded-lg shadow-lg text-white transform transition-all duration-300 translate-y-20 z-50 ${type === 'error' ? 'bg-red-500' : 'bg-green-500'}`;
            
            requestAnimationFrame(() => {
                toast.classList.remove('translate-y-20');
            });

            setTimeout(() => {
                toast.classList.add('translate-y-20');
            }, 3000);
        }

        // --- Init ---
        if(auth) {
            onAuthStateChanged(auth, (user) => {
                currentUser = user;
                if (user && !user.isAnonymous) {
                    authBtn.innerText = "Sair";
                    const userName = user.displayName || (user.email ? user.email.split('@')[0] : 'Utilizador');
                    userBadge.innerText = userName;
                    userBadge.classList.remove('hidden');
                } else {
                    authBtn.innerText = "Entrar / Criar Conta";
                    userBadge.classList.add('hidden');
                }
                updateCounterUI();
            });
        }
        
        // Defaults
        window.currentType = 'url';
        initQR();
        updateCounterUI();

    </script>

    <style>
        body { font-family: 'Outfit', sans-serif; }
        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        input[type="file"]::file-selector-button {
            display: none;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col">

    <!-- Header -->
    <header class="w-full p-4 md:px-8 flex justify-between items-center border-b border-gray-800 bg-gray-900/80 sticky top-0 z-40 backdrop-blur-md">
        <div class="flex items-center gap-2">
            <div class="w-8 h-8 bg-gradient-to-tr from-indigo-500 to-purple-500 rounded-lg flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z" />
                </svg>
            </div>
            <h1 class="text-xl font-bold tracking-wide">QR Master</h1>
        </div>
        
        <div class="flex items-center gap-4">
            <span id="userBadge" class="hidden text-sm text-indigo-400 font-semibold border border-indigo-500/30 px-3 py-1 rounded-full"></span>
            <button id="authBtn" onclick="toggleLoginModal()" class="text-sm bg-gray-800 hover:bg-gray-700 border border-gray-700 px-4 py-2 rounded-lg transition-colors">
                Carregando...
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto p-4 md:p-8 flex flex-col lg:flex-row gap-8">
        
        <!-- Left Panel: Configuration -->
        <div class="w-full lg:w-1/2 glass-panel rounded-2xl p-6 shadow-2xl">
            <h2 class="text-2xl font-bold mb-6 text-gray-100">Criar Novo QR Code</h2>

            <!-- Type Selector -->
            <div class="grid grid-cols-5 gap-2 mb-6">
                <button onclick="switchTab('url')" class="type-tab py-2 px-2 rounded-lg bg-indigo-600 text-white font-medium text-xs md:text-sm transition-all text-center">
                    Link
                </button>
                <button onclick="switchTab('text')" class="type-tab py-2 px-2 rounded-lg bg-gray-700 text-gray-300 font-medium text-xs md:text-sm transition-all text-center">
                    Texto
                </button>
                <button onclick="switchTab('wifi')" class="type-tab py-2 px-2 rounded-lg bg-gray-700 text-gray-300 font-medium text-xs md:text-sm transition-all text-center">
                    Wi-Fi
                </button>
                <button onclick="switchTab('pix')" class="type-tab py-2 px-2 rounded-lg bg-gray-700 text-gray-300 font-medium text-xs md:text-sm transition-all text-center flex items-center justify-center gap-1">
                    <span class="text-green-400">‚ùñ</span> Pix
                </button>
                <button onclick="switchTab('2fa')" class="type-tab py-2 px-2 rounded-lg bg-gray-700 text-gray-300 font-medium text-xs md:text-sm transition-all text-center flex items-center justify-center gap-1">
                    <span class="text-blue-400">üîí</span> 2FA
                </button>
            </div>

            <!-- Input Fields -->
            <div class="space-y-4 min-h-[250px]">
                
                <!-- URL Input -->
                <div id="input-url" class="input-section">
                    <label class="block text-gray-400 text-sm mb-2">Cole o seu link aqui</label>
                    <input type="url" id="url-val" placeholder="https://seu-site.com" class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500 transition-all">
                </div>

                <!-- Text Input -->
                <div id="input-text" class="input-section hidden">
                    <label class="block text-gray-400 text-sm mb-2">Digite seu texto</label>
                    <textarea id="text-val" rows="4" placeholder="Escreva algo..." class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:border-indigo-500 focus:outline-none transition-all"></textarea>
                </div>

                <!-- WiFi Input -->
                <div id="input-wifi" class="input-section hidden space-y-3">
                    <div>
                        <label class="block text-gray-400 text-sm mb-1">Nome da Rede (SSID)</label>
                        <input type="text" id="wifi-ssid" class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:border-indigo-500 outline-none">
                    </div>
                    <div>
                        <label class="block text-gray-400 text-sm mb-1">Senha</label>
                        <input type="text" id="wifi-pass" class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:border-indigo-500 outline-none">
                    </div>
                    <div>
                        <label class="block text-gray-400 text-sm mb-1">Seguran√ßa</label>
                        <select id="wifi-type" class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:border-indigo-500 outline-none">
                            <option value="WPA">WPA/WPA2</option>
                            <option value="WEP">WEP</option>
                            <option value="nopass">Sem Senha</option>
                        </select>
                    </div>
                </div>

                <!-- Pix Input -->
                <div id="input-pix" class="input-section hidden space-y-3">
                    <div class="bg-gray-800/50 p-3 rounded-lg border border-yellow-500/30 mb-2">
                        <p class="text-xs text-yellow-200">‚ö†Ô∏è Aten√ß√£o: Teste o QR Code com um valor baixo antes de usar comercialmente.</p>
                    </div>
                    <div>
                        <label class="block text-gray-400 text-sm mb-1">Chave Pix (CPF, Email, Aleat√≥ria...)</label>
                        <input type="text" id="pix-key" placeholder="ex: 123.456.789-00" class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:border-indigo-500 outline-none">
                    </div>
                    <div class="flex gap-3">
                        <div class="flex-1">
                            <label class="block text-gray-400 text-sm mb-1">Nome do Benefici√°rio</label>
                            <input type="text" id="pix-name" placeholder="Seu Nome" class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:border-indigo-500 outline-none">
                        </div>
                        <div class="w-1/3">
                            <label class="block text-gray-400 text-sm mb-1">Cidade</label>
                            <input type="text" id="pix-city" placeholder="Cidade" class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:border-indigo-500 outline-none">
                        </div>
                    </div>
                    <div>
                        <label class="block text-gray-400 text-sm mb-1">Valor (Opcional)</label>
                        <input type="number" step="0.01" id="pix-amount" placeholder="0.00" class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:border-indigo-500 outline-none">
                    </div>
                </div>

                <!-- 2FA Input -->
                <div id="input-2fa" class="input-section hidden space-y-3">
                    <div class="bg-indigo-900/30 p-3 rounded-lg border border-indigo-500/30 mb-2">
                        <p class="text-xs text-indigo-200">‚ÑπÔ∏è Cria c√≥digos para apps como Google Authenticator ou Authy.</p>
                    </div>
                    <div>
                        <label class="block text-gray-400 text-sm mb-1">Chave Secreta (Secret Key)</label>
                        <input type="text" id="2fa-secret" placeholder="ex: JBSWY3DPEHPK3PXP" class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:border-indigo-500 outline-none font-mono">
                    </div>
                    <div class="flex gap-3">
                        <div class="flex-1">
                            <label class="block text-gray-400 text-sm mb-1">Nome da Conta (Usu√°rio)</label>
                            <input type="text" id="2fa-account" placeholder="ex: seu@email.com" class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:border-indigo-500 outline-none">
                        </div>
                        <div class="flex-1">
                            <label class="block text-gray-400 text-sm mb-1">Emissor (App/Site)</label>
                            <input type="text" id="2fa-issuer" placeholder="ex: MinhaEmpresa" class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:border-indigo-500 outline-none">
                        </div>
                    </div>
                </div>

            </div>

            <!-- Customization (Image) -->
            <div class="mt-6 pt-6 border-t border-gray-700">
                <h3 class="text-sm font-semibold text-gray-300 mb-3 flex items-center justify-between">
                    Adicionar Logo (Centro)
                    <span class="text-xs text-indigo-400 bg-indigo-900/30 px-2 py-0.5 rounded border border-indigo-500/30">Requer Login</span>
                </h3>
                
                <div class="relative group">
                    <input type="file" id="logoInput" accept="image/*" class="w-full text-sm text-gray-400
                        file:mr-4 file:py-2 file:px-4
                        file:rounded-full file:border-0
                        file:text-sm file:font-semibold
                        file:bg-indigo-600 file:text-white
                        hover:file:bg-indigo-700
                        cursor-pointer bg-gray-800 rounded-lg p-1 border border-gray-700
                    "/>
                    
                    <!-- Lock Overlay for Guests -->
                    <div id="lockOverlay" class="absolute inset-0 bg-gray-900/80 backdrop-blur-[1px] rounded-lg flex items-center justify-center cursor-not-allowed">
                        <div class="text-center" onclick="toggleLoginModal()">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-400 mx-auto mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                            </svg>
                            <span class="text-xs text-gray-300 font-medium">Fa√ßa login para desbloquear</span>
                        </div>
                    </div>
                </div>

                <!-- ImgBB Helper -->
                <div class="mt-4 p-3 bg-gray-800/50 rounded-lg border border-gray-700 text-xs text-gray-400">
                    <div class="flex items-start gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <div>
                            <p class="mb-1">Precisa hospedar uma imagem na web para usar em links?</p>
                            <p class="mb-2">Recomendamos o <strong>ImgBB</strong>. Crie uma conta l√° para hospedar suas imagens gratuitamente.</p>
                            <button onclick="openImgBB()" class="text-blue-400 hover:text-blue-300 underline font-semibold">Ir para o ImgBB &rarr;</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Generate Button -->
            <button id="generateBtn" onclick="generateQR()" class="w-full mt-6 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-bold py-4 rounded-xl shadow-lg transform transition hover:scale-[1.02] active:scale-[0.98]">
                GERAR QR CODE
            </button>
            <p id="limitCounter" class="text-center text-xs text-gray-500 mt-2">Carregando status...</p>
        </div>

        <!-- Right Panel: Preview -->
        <div class="w-full lg:w-1/2 flex flex-col items-center justify-center">
            <div class="bg-white p-6 rounded-3xl shadow-[0_0_50px_rgba(79,70,229,0.2)] mb-8 transform transition hover:rotate-1">
                <div id="canvas-container"></div>
            </div>

            <div class="flex gap-4">
                <button onclick="downloadQR()" id="downloadBtn" class="flex items-center gap-2 bg-gray-800 hover:bg-gray-700 text-white px-6 py-3 rounded-full font-semibold transition-all border border-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                    </svg>
                    Baixar PNG
                </button>
            </div>
            
            <p class="mt-8 text-gray-500 text-sm max-w-xs text-center">
                O QR Master gera c√≥digos de alta resolu√ß√£o compat√≠veis com todas as c√¢meras de smartphones modernas.
            </p>
        </div>
    </main>

    <!-- Modal Login -->
    <div id="loginModal" class="fixed inset-0 bg-black/80 z-50 hidden items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-gray-800 rounded-2xl p-8 max-w-md w-full border border-gray-700 shadow-2xl relative">
            <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-500 hover:text-white">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            
            <h2 class="text-2xl font-bold text-center mb-6">Acesse o QR Master</h2>
            <p class="text-gray-400 text-center text-sm mb-8">Fa√ßa login para criar QR Codes ilimitados e adicionar logotipos personalizados.</p>

            <!-- Google Login Button -->
            <button onclick="loginWithGoogle()" class="w-full bg-white hover:bg-gray-100 text-gray-900 font-bold py-3 px-4 rounded-lg flex items-center justify-center gap-3 transition-colors mb-6">
                <svg class="w-5 h-5" viewBox="0 0 24 24">
                    <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                    <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                    <path fill="#FBBC05" d="M5.84 14.17c-.22-.66-.35-1.36-.35-2.17s.13-1.51.35-2.17V7.01H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.99l3.66-2.82z"/>
                    <path fill="#EA4335" d="M12 4.63c1.61 0 3.06.56 4.21 1.64l3.16-3.16C17.45 1.18 14.97 0 12 0 7.7 0 3.99 2.47 2.18 7.01l3.66 2.82c.87-2.6 3.3-4.53 6.16-4.53z"/>
                </svg>
                Continuar com Google
            </button>

            <div class="relative flex py-2 items-center mb-6">
                <div class="flex-grow border-t border-gray-600"></div>
                <span class="flex-shrink-0 mx-4 text-gray-500 text-xs">OU USE E-MAIL</span>
                <div class="flex-grow border-t border-gray-600"></div>
            </div>

            <input type="email" id="emailInput" placeholder="seu@email.com" class="w-full bg-gray-900 border border-gray-600 rounded-lg p-3 mb-3 text-white focus:border-indigo-500 outline-none">
            <input type="password" id="passInput" placeholder="Senha" class="w-full bg-gray-900 border border-gray-600 rounded-lg p-3 mb-6 text-white focus:border-indigo-500 outline-none">

            <div class="flex gap-3">
                <button onclick="handleEmailAuth(false)" class="flex-1 bg-indigo-600 hover:bg-indigo-700 py-2 rounded-lg font-semibold transition-colors">Entrar</button>
                <button onclick="handleEmailAuth(true)" class="flex-1 border border-indigo-600 text-indigo-400 hover:bg-indigo-900/30 py-2 rounded-lg font-semibold transition-colors">Cadastrar</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-5 right-5 px-6 py-3 rounded-lg shadow-lg text-white transform transition-all duration-300 translate-y-20 z-50 bg-green-500">
        Mensagem
    </div>

</body>
</html>
